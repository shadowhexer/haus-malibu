<!DOCTYPE html>
<html lang="en">

<head>
    <!-- <script type="text/javascript" src="./js/receipt.js"></script> -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guest Information</title>
    <script type="module" src='./js/html-include-element.js'></script>
    <script type="module" src="./js/webcomponents-loader.js"></script>
    <link rel="stylesheet" href="./css/guest-info.css">
    <link rel="stylesheet" href="./css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
        integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body>
    <html-include src="./header.html" no-shadow same-origin></html-include>

    <section class="hero">
        <div class="hero-content">
            <h1>Receipt Information</h1>
        </div>
    </section>

    <section class="guest-info-section">
        <h2>Receipt Details</h2>

        <ul id="receipt-list" class="receipt"></ul>

    </section>

    <footer>
        <img class="footer-logo" src="images/logo.png" alt="Haus Malibu Logo">
        <div class="social-links">
            <a href="https://www.facebook.com" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
            <a href="https://instagram.com" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
            <a href="https://gmail.com" aria-label="Email"><i class="fas fa-envelope"></i></a>
        </div>
        <p>&copy; 2025 Haus Malibu. All rights reserved.</p>
    </footer>
    <script>
        let receipt = [];

        // Fetching the GET parameters in the URL
        const urlParams = new URLSearchParams(window.location.search);
        const id = urlParams.get('id');

        if (!isNaN(id)) {
            addReceipt(id);
        } else {
            console.warn("No room ID found in URL.");
        }

        function addReceipt(bookId) {
            const formData = new FormData();
            formData.append('book-id', bookId);

            fetch('/api/retrieve_booking', {
                method: 'POST',
                body: formData
            })
                .then(response => response.json())
                .then(data => {
                    receipt = data;
                    displayReceipt();
                })
                .catch(err => {
                    console.log('Error: ' + err.message);
                });
        }

        function displayReceipt() {
            const list = document.getElementById("receipt-list");
            list.innerHTML = '';

            list.innerHTML += `
        <li class="booking-item" data-id="${booking.book_id}">
          <div>
            <strong>Book ID:</strong> ${booking.book_id}<br>
            <strong>Room:</strong> ${booking.room_name}<br>
            <strong>Name:</strong> ${booking.first_name} ${booking.last_name}<br>
            <strong>Check-in:</strong> ${booking.check_in}<br>
            <strong>Check-out:</strong> ${booking.check_out}<br>
            <strong>Booking Time:</strong> ${booking.date}<br>
          </div>
          <div class="booking-actions">
            <button type="button" class="generate-btn" onclick="generatePDF()">Download Report</button>
            <button type="button" class="generate-btn" onclick="window.location.href='rooms.html'">Exit</button>
          </div>
        </li>`;
        };

        function generatePDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const rows = [booking].map(b => [
                b.book_id, b.first_name, b.last_name, b.checkIn, b.checkOut, b.date,
            ]);

            doc.text("Haus Malibu Booking Report", 14, 15);
            doc.autoTable({
                startY: 20,
                head: [["Book ID", "First Name", "Last Name", "Check-in", "Check-out", "Time"]],
                body: rows,
                styles: { cellPadding: 3 },
                theme: "grid"
            });

            doc.save("Haus Malibu Receipt.pdf");
        };
    </script>

</body>

</html>