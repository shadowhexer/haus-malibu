<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Panel</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
  <link rel="stylesheet" href="css/admin-css.css">
</head>

<body>
  <header>
    <div class="logo">
      <img src="images/logo.png" alt="Haus Malibu Logo">
      <span style="font-family: impact; color: #45a049; font-size: 35px;">HAUS MALIBU<br>
        <p
          style="font-size: 10px; color: #000; font-style: italic; font-family: 'Courier New', Courier, monospace; font">
          Your Comfort is our Main Concern</p>
      </span>
    </div>
    <nav>
      <a href="#" style="color: #4CAF50;">Home</a>
      <a href="#" style="color: #4CAF50;">Rooms</a>
      <a href="#" style="color: #4CAF50;">About Us</a>
      <a href="#" style="color: #4CAF50;">News & Updates</a>
    </nav>
  </header>

  <div class="admin-container">
    <!-- Manage Bookings -->
    <div class="admin-card">
      <h2>BOOKINGS</h2>
      <ul id="bookingList" class="booking-list"></ul>
      <h3>Add Booking</h3>
      <form id="book_form">
        <input type="text" id="book_id" name="book_id" placeholder="Book ID">
        <!-- <input type="date" id="check-in">
      <input type="date" id="check-out"> -->
        <button type="button" class="add-btn" onclick="addBooking()">Add Booking</button>
        <button type="button" class="generate-btn" onclick="generatePDF()">Download Report</button>
      </form>

    </div>

    <!-- Manage Rooms -->
    <div class="admin-card">
      <h2>ROOMS</h2>
      <ul id="roomList" class="room-list"></ul>
      <h3>Add Room</h3>
      <input type="text" id="room-name" placeholder="Room Name">
      <textarea id="room-desc" placeholder="Room Description"></textarea>
      <input type="file" id="room-image">
      <button class="add-btn" onclick="addRoom()">Add Room</button>
    </div>

    <!-- Manage News and Updates -->
    <div class="admin-card">
      <h2>NEWS AND UPDATES</h2>
      <ul id="newsList" class="news-list"></ul>
      <h3>Add News</h3>
      <input type="text" id="news-title" placeholder="News Title">
      <textarea id="news-content" placeholder="News Content"></textarea>
      <input type="file" id="news-image">
      <button class="add-btn" onclick="addNews()">Add News</button>
    </div>
  </div>

  <footer>
    <img class="footer-logo" src="images/logo.png" alt="Haus Malibu Logo">
    <div class="social-links">
      <a href="https://www.facebook.com" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
      <a href="https://instagram.com" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
      <a href="https://gmail.com" aria-label="Email"><i class="fas fa-envelope"></i></a>
    </div>
    <p>&copy; 2025 Haus Malibu. All rights reserved.</p>
  </footer>

  <script>
    let booking = [], rooms = [], news = [];

    function addBooking(event) {
      const form = document.getElementById('book_form');
      const formData = new FormData(form);

      fetch(window.location.origin + '/haus-malibu/retrieve_booking.php', {
        method: 'POST',
        body: formData,
      })
        .then(response => response.json())
        .then(data => {
          if (data.status === 0) data.status = 'Pending';
          else if (data.status === 1) data.status = 'Accepted';
          else if (data.status === 2) data.status = 'Declined';
          booking = data
          displayBookings();
        })
        .catch(err => {
          console.log('Error: ' + err.message);
        })
        .finally(() => {
          document.getElementById("book_id").value = '';
          // document.getElementById("check-in").value = '';
          // document.getElementById("check-out").value = '';
        });
    }

    function displayBookings() {
      const list = document.getElementById("bookingList");
      list.innerHTML = '';

      let color = booking.status === "Accepted" ? "green" :
        booking.status === "Declined" ? "red" : "orange";
      list.innerHTML += `
        <li class="booking-item" data-id="${booking.book_id}">
          <div>
            <strong>Book ID:</strong> ${booking.book_id}<br>
            <strong>Name:</strong> ${booking.first_name} ${booking.last_name}<br>
            <strong>Check-in:</strong> ${booking.check_in}<br>
            <strong>Check-out:</strong> ${booking.check_out}<br>
            <strong>Booking Time:</strong> ${booking.date}<br>
            <strong>Status:</strong> <span id="status-${booking.status}" style="color: ${color}; font-weight: bold;">${booking.status}</span>
          </div>
          ${booking.status === "Pending" ? `
          <div class="booking-actions">
            <button class="accept-btn" onclick="modifyBooking('${booking.book_id}', '1')">Accept</button>
            <button class="decline-btn" onclick="modifyBooking('${booking.book_id}', '2')">Decline</button>
          </div>
          ` : ''}
        </li>`;
    };


    function modifyBooking(id, bookStatus) {

      fetch(window.location.origin + '/haus-malibu/modify_booking.php', {
        method: 'POST',
        body: JSON.stringify({ book_id: id, status: bookStatus }),
        headers: { 'Content-Type': 'application/json' }
      })
        .then(response => response.json())
        .then(data => {
          alert(data.message);
          window.location.href = 'admin.html'
        })
        .catch(err => {
          console.log('Error: ' + err.message);
        })
    }

    function generatePDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      const rows = [booking].map(b => [
        b.book_id, b.first_name, b.last_name, b.checkIn, b.checkOut, b.date,
        {
          content: b.status,
          styles: {
            fontStyle: 'bold',
            textColor: b.status === "Accepted" ? [40, 167, 69] :
              b.status === "Declined" ? [220, 53, 69] : [255, 193, 7]
          }
        }
      ]);

      doc.text("Haus Malibu Booking Report", 14, 15);
      doc.autoTable({
        startY: 20,
        head: [["Book ID", "First Name", "Last Name", "Check-in", "Check-out", "Time", "Status"]],
        body: rows,
        styles: { cellPadding: 3 },
        theme: "grid"
      });

      doc.save("Haus Malibu Bookings.pdf");
    }

    function addRoom() {
      const name = document.getElementById("room-name").value;
      const desc = document.getElementById("room-desc").value;
      const image = document.getElementById("room-image").files[0];

      if (name && desc && image) {
        const reader = new FileReader();
        reader.onload = () => {
          rooms.push({ id: Date.now(), name, desc, image: reader.result });
          displayRooms();
        };
        reader.readAsDataURL(image);
      }
    }

    function displayRooms() {
      const list = document.getElementById("roomList");
      list.innerHTML = '';
      rooms.forEach(r => {
        list.innerHTML += `
        <li class="room-item">
          <div>
            <strong>${r.name}</strong><br>
            ${r.desc}<br>
            <img src="${r.image}" alt="Room image">
          </div>
          <div class="room-actions">
            <button class="edit-btn">Edit</button>
            <button class="delete-btn">Delete</button>
          </div>
        </li>`;
      });
    }

    function addNews() {
      const title = document.getElementById("news-title").value;
      const content = document.getElementById("news-content").value;
      const image = document.getElementById("news-image").files[0];

      if (title && content && image) {
        const reader = new FileReader();
        reader.onload = () => {
          news.push({ id: Date.now(), title, content, image: reader.result });
          displayNews();
        };
        reader.readAsDataURL(image);
      }
    }

    function displayNews() {
      const list = document.getElementById("newsList");
      list.innerHTML = '';
      news.forEach(n => {
        list.innerHTML += `
        <li class="news-item">
          <div>
            <strong>${n.title}</strong><br>
            ${n.content}<br>
            <img src="${n.image}" alt="News image">
          </div>
          <div class="news-actions">
            <button class="edit-btn">Edit</button>
            <button class="delete-btn">Delete</button>
          </div>
        </li>`;
      });
    }
  </script>
</body>

</html>